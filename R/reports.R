#' List reports found in report directory
#'
#' Makes a list of raw report files in `report_source_folders`.
#' This function descends the directories rooted at `report_source_folders` to find all reports to be run.
#' Reports to be run are identified by filename extensions,
#' by default `c(".Rmd", ".Rnw")`.
#'
#' Users can override the default value of `report_source_folders` to supply their own
#' report directory(ies) of reports.
#' If users want to also include the default reports,
#' be sure to include `system.file(file.path("reports"), package = "SEAPSUTWorkflow")`
#' in the vector of paths supplied to `report_source_folders`.
#'
#' @param report_source_folders A string that identifies a directory of reports to be generated.
#'                              Default is `system.file(file.path("reports"), package = "SEAPSUTWorkflow")`,
#'                              which provides some default reports.
#' @param report_suffixes A vector of strings of report suffixes. Default is `c(".Rmd", ".Rnw")`.
#'
#' @return A vector of absolute paths to reports to be generated.
#'
#' @export
#'
#' @examples
report_source_paths <- function(report_source_folders = system.file(file.path("reports"), package = "SEAPSUTWorkflow"),
                          report_suffixes = c(".Rmd", ".Rnw")) {

  # Make a list in which we'll collect paths to all reports that need to be run.
  report_files <- list()
  # Cycle through all paths
  for (rs in report_source_folders) {
    all_files <- list.files(path = rs, full.names = TRUE, recursive = TRUE, include.dirs = TRUE)
    for (suff in report_suffixes) {
      which_files_are_reports <- which(endsWith(all_files, suffix = suff), arr.ind = TRUE)
      if (length(which_files_are_reports) > 0) {
        report_files <- append(report_files, all_files[which_files_are_reports])
      }
    }
  }
  unlist(report_files)
}


#' Generate reports found in report directory
#'
#' This function builds all `report_source_files` with `knitr::knit()`.
#'
#' Each report name is suffixed by date and time (down to the second).
#' Duplicate report names in `report_source_files` generates an error.
#'
#' Previous reports are shuffled to a folder named `<<report_name>>_prev`.
#'
#' @param report_source_files A vector of absolute paths to reports that need to be run,
#'                            probably generated by `report_source_paths()`.
#' @param report_dest_folder A string that identifies the directory into which the completed reports should be written.
#'                           Default is `drake::readd(SEAPSUTWorkflow::target_names[["report_dest_folder"]]`
#'
#' @return A boolean. `TRUE` for success with all reports, `FALSE` if an error occurred with any report.
#' @export
#'
#' @examples
generate_reports <- function(report_source_files,
                             report_dest_folder = drake::readd(SEAPSUTWorkflow::target_names[["report_dest_folder"]])) {
  # for (f in report_source_files) {
  #   out_name <- basename(f)
  #   knitr::knit(input = f, )
  #
  # }
  #
  #
# print("would generate reports here")
return(FALSE)

}
